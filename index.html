<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Weekly Board</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
  background:#f7f7f9;
}

header{
  position:sticky;
  top:0;
  background:white;
  padding:10px;
  border-bottom:1px solid #ddd;
  display:flex;
  justify-content:space-between;
  align-items:center;
  z-index:10;
}

#cloudBar button{
  margin-left:6px;
  padding:6px 10px;
  border-radius:8px;
  border:1px solid #ccc;
  background:white;
  font-size:12px;
}

section{
  padding:12px;
}

input, textarea{
  width:100%;
  padding:8px;
  margin-bottom:8px;
  border-radius:8px;
  border:1px solid #ccc;
  font-size:14px;
}

button{
  padding:8px 12px;
  border-radius:8px;
  border:1px solid #ccc;
  background:white;
  font-size:14px;
}

.day{
  background:white;
  padding:10px;
  border-radius:12px;
  margin-bottom:12px;
}

.dayHeader{
  font-size:14px;
  margin-bottom:6px;
}

.task{
  padding:8px 10px;
  border-radius:10px;
  margin-bottom:6px;
  cursor:pointer;
  user-select:none;
}

.task.done{
  opacity:.6;
}

.archive{
  background:white;
  padding:10px;
  border-radius:12px;
  margin-top:20px;
}

.moving{
  outline:2px dashed #4da3ff;
}

.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.3);
  display:none;
  align-items:center;
  justify-content:center;
}

.modalContent{
  background:white;
  padding:16px;
  border-radius:12px;
  width:90%;
  max-width:400px;
}

.checkItem{
  display:flex;
  align-items:center;
  margin-bottom:6px;
}

.checkItem input{
  margin-right:6px;
}
</style>
</head>
<body>

<header>
  <div id="cloudStatus">Cloud: 연결 안 됨</div>
  <div id="cloudBar">
    <button id="syncBtn">동기화</button>
    <button id="cloudBtn">로그인</button>
  </div>
</header>

<section>
  <input id="taskInput" placeholder="과제 이모티콘을 입력해줘" />
  <textarea id="descInput" placeholder="발동 요인(Trigger)을 입력해줘"></textarea>
  <button id="addBtn">과제 추가</button>
</section>

<section id="boardSection"></section>

<section class="archive" id="archiveSection"></section>

<div class="modal" id="taskModal">
  <div class="modalContent">
    <div id="modalTitle"></div>
    <textarea id="modalDesc"></textarea>
    <div id="checklistContainer"></div>
    <input id="checkInput" placeholder="수행 요소(Action)을 입력해줘" />
    <button id="addCheckBtn">추가</button>
    <button id="duplicateBtn">복제</button>
    <button id="deleteBtn">삭제</button>
    <button id="closeBtn">닫기</button>
  </div>
</div>

<script>
const days=["일","월","화","수","목","금","토"];
let board={};
let archive=[];
let movingTask=null;

days.forEach(d=>board[d]=[]);

const boardSection=document.getElementById("boardSection");
const archiveSection=document.getElementById("archiveSection");

function randomColor(){
  const colors=["#ffd1dc","#c1f0dc","#d1e8ff","#fce1b5","#e5d1ff","#d4f1f9","#ffe4b5","#e2f0cb"];
  return colors[Math.floor(Math.random()*colors.length)];
}

function render(){
  boardSection.innerHTML="";
  days.forEach(day=>{
    const div=document.createElement("div");
    div.className="day";
    div.innerHTML=`<div class="dayHeader">${day}</div>`;
    board[day].forEach(task=>{
      const t=document.createElement("div");
      t.className="task"+(task.done?" done":"");
      t.style.background=task.color;
      t.textContent=task.title;
      t.oncontextmenu=e=>e.preventDefault();
      t.onmousedown=()=>startMove(task);
      t.onclick=()=>openModal(task,day);
      div.appendChild(t);
    });
    div.onclick=()=>dropToDay(day);
    boardSection.appendChild(div);
  });

  archiveSection.innerHTML="<div class='dayHeader'>Archive</div>";
  archive.forEach(task=>{
    const t=document.createElement("div");
    t.className="task"+(task.done?" done":"");
    t.style.background=task.color;
    t.textContent=task.title;
    t.onmousedown=()=>startMove(task);
    t.onclick=()=>openModal(task,"archive");
    archiveSection.appendChild(t);
  });
  archiveSection.onclick=()=>dropToArchive();
}

function startMove(task){
  movingTask=task;
  document.body.classList.add("moving");
}

function dropToDay(day){
  if(!movingTask)return;
  removeTask(movingTask);
  board[day].push(movingTask);
  movingTask=null;
  render();
}

function dropToArchive(){
  if(!movingTask)return;
  removeTask(movingTask);
  archive.push(movingTask);
  movingTask=null;
  render();
}

function removeTask(task){
  days.forEach(d=>{
    board[d]=board[d].filter(t=>t!==task);
  });
  archive=archive.filter(t=>t!==task);
}

document.getElementById("addBtn").onclick=()=>{
  const title=document.getElementById("taskInput").value;
  const desc=document.getElementById("descInput").value;
  if(!title)return;
  board["일"].push({
    title,
    desc,
    checklist:[],
    done:false,
    color:randomColor()
  });
  document.getElementById("taskInput").value="";
  document.getElementById("descInput").value="";
  render();
};

const modal=document.getElementById("taskModal");
let currentTask=null;
let currentLocation=null;

function openModal(task,loc){
  currentTask=task;
  currentLocation=loc;
  modal.style.display="flex";
  document.getElementById("modalTitle").textContent=task.title;
  document.getElementById("modalDesc").value=task.desc||"";
  renderChecklist();
}

function renderChecklist(){
  const container=document.getElementById("checklistContainer");
  container.innerHTML="";
  currentTask.checklist.forEach(item=>{
    const div=document.createElement("div");
    div.className="checkItem";
    div.innerHTML=`<input type='checkbox' ${item.done?"checked":""}/> <span>${item.text}</span>`;
    div.querySelector("input").onchange=e=>{
      item.done=e.target.checked;
    };
    container.appendChild(div);
  });
}

document.getElementById("addCheckBtn").onclick=()=>{
  const val=document.getElementById("checkInput").value;
  if(!val)return;
  currentTask.checklist.push({text:val,done:false});
  document.getElementById("checkInput").value="";
  renderChecklist();
};

document.getElementById("duplicateBtn").onclick=()=>{
  const copy=JSON.parse(JSON.stringify(currentTask));
  copy.color=randomColor();
  if(currentLocation==="archive")archive.push(copy);
  else board[currentLocation].push(copy);
  render();
};

document.getElementById("deleteBtn").onclick=()=>{
  removeTask(currentTask);
  modal.style.display="none";
  render();
};

document.getElementById("closeBtn").onclick=()=>{
  currentTask.desc=document.getElementById("modalDesc").value;
  modal.style.display="none";
  render();
};

render();
</script>
</body>
</html>
